<html>
  <head>
    <meta charset="UTF-8">
    <title> V√µ B√≠ch Ng·ªçc - Weather API </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/weatherapi.css">
  </head>

  <body>
     <h2>üå¶ D·ª± b√°o th·ªùi ti·∫øt Tu·ªïi Tr·∫ª</h2>
    <select id="provinces">
        <option value="">-- Ch·ªçn t·ªânh/th√†nh ph·ªë --</option>
    </select>
    <div id="weather-result"></div>

    <script>
        var ids = [
            '2347719','20070078','20070086','2347731','2347730','20070081','20070087','20070084',
            '20070088','2347703','2347704','20070082','2347732','28301718','20070085','1252375',
            '2347720','28301719','2347721','2347722','2347733','2347727','2347728','2347734',
            '2347741','2347736','2347737','20070079','20070080','2347707','28301720','2347738',
            '2347723','20070076','2347708','2347710','2347740','2347709','2347718','20070089',
            '2347742','2347743','2347744','20070091','2347745','2347746','2347711','20070077',
            '2347712','2347747','2347748','2347713','2347715','2347716','20070083','2347749',
            '2347717','2347750','2347751','2347714','2347752','20070090','2347729','2347753'
        ];

        var names = [
            'An Giang','B√¨nh D∆∞∆°ng','B√¨nh Ph∆∞·ªõc','B√¨nh Thu·∫≠n','B√¨nh ƒê·ªãnh','B·∫°c Li√™u','B·∫Øc Giang','B·∫Øc K·∫°n',
            'B·∫Øc Ninh','B·∫øn Tre','Cao B·∫±ng','C√† Mau','C·∫ßn Th∆°','ƒêi·ªán Bi√™n','ƒê√† N·∫µng','ƒê√† L·∫°t',
            'ƒê·∫Øk L·∫Øk','ƒê·∫Øk N√¥ng','ƒê·ªìng Nai','ƒê·ªìng Th√°p','Gia Lai','H√† N·ªôi','TP. H·ªì Ch√≠ Minh','H√† Giang',
            'H√† Nam','H√† Tƒ©nh','H√≤a B√¨nh','H∆∞ng Y√™n','H·∫£i D∆∞∆°ng','H·∫£i Ph√≤ng','H·∫≠u Giang','Kh√°nh H√≤a',
            'Ki√™n Giang','Kon Tum','Lai Ch√¢u','Long An','L√†o Cai','L√¢m ƒê·ªìng','L·∫°ng S∆°n','Nam ƒê·ªãnh',
            'Ngh·ªá An','Ninh B√¨nh','Ninh Thu·∫≠n','Ph√∫ Th·ªç','Ph√∫ Y√™n','Qu·∫£ng B√¨nh','Qu·∫£ng Nam','Qu·∫£ng Ng√£i',
            'Qu·∫£ng Ninh','Qu·∫£ng Tr·ªã','S√≥c TrƒÉng','S∆°n La','Thanh H√≥a','Th√°i B√¨nh','Th√°i Nguy√™n','Th·ª´a Thi√™n Hu·∫ø',
            'Ti·ªÅn Giang','Tr√† Vinh','Tuy√™n Quang','T√¢y Ninh','Vƒ©nh Long','Vƒ©nh Ph√∫c','V≈©ng T√†u','Y√™n B√°i'
        ];

        function load_provinces() {
            const provinces = document.getElementById("provinces");
            for (let i = 0; i < ids.length; i++) {
                const opt = document.createElement("option");
                opt.value = ids[i];
                opt.textContent = names[i];
                provinces.appendChild(opt);
            }
            
            // Th√™m event listener sau khi load xong
            provinces.addEventListener('change', function() {
                show_detail_weather_forecast(this.value);
            });
        }

        function show_detail_weather_forecast(id) {
            if (!id) {
                document.getElementById("weather-result").innerHTML = "Ch·ªçn t·ªânh ƒë·ªÉ xem th√¥ng tin th·ªùi ti·∫øt.";
                return;
            }

            document.getElementById("weather-result").innerHTML = "ƒêang t·∫£i d·ªØ li·ªáu...";
            
            // S·ª≠ d·ª•ng API thay th·∫ø n·∫øu API g·ªëc l·ªói
            const apiUrl = `https://api.codetabs.com/v1/proxy?quest=https://utils3.cnnd.vn/ajax/weatherinfo/${id}.htm`;
            
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('L·ªói k·∫øt n·ªëi API');
                    }
                    return response.json();
                })
                .then(res => {
                    if (res.Data && res.Data.data && res.Data.data.datainfo) {
                        const data = res.Data.data.datainfo;
                        displayWeatherData(data);
                    } else {
                        throw new Error('D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá');
                    }
                })
                .catch(error => {
                    console.error('L·ªói:', error);
                    document.getElementById("weather-result").innerHTML = 
                        "Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu th·ªùi ti·∫øt. Vui l√≤ng th·ª≠ l·∫°i sau.";
                });
        }

        function displayWeatherData(data) {
            document.getElementById("weather-result").innerHTML = `
                <div class="weather-card">
                    <h3>${data.location || 'Kh√¥ng c√≥ d·ªØ li·ªáu'}</h3>
                    ${data.shadow_icon ? `<img src="${data.shadow_icon}" alt="icon th·ªùi ti·∫øt">` : ''}
                    <div class="temp">${data.temperature || 'N/A'}¬∞${data.degree || 'C'}</div>
                    <p>${data.status || 'Kh√¥ng c√≥ th√¥ng tin'}</p>
                    <table class="detail-table">
                        <tr><th>C·∫£m gi√°c nh∆∞:</th><td>${data.feels_like || 'N/A'}¬∞${data.degree || 'C'}</td></tr>
                        <tr><th>ƒê·ªô ·∫©m:</th><td>${data.humidity || 'N/A'}</td></tr>
                        <tr><th>T·ªëc ƒë·ªô gi√≥:</th><td>${data.wind ? data.wind.index + ' ' + data.wind.unit : 'N/A'}</td></tr>
                        <tr><th>H∆∞·ªõng gi√≥:</th><td>${data.windDirection || 'N/A'}</td></tr>
                        <tr><th>UV:</th><td>${data.UV_index ? data.UV_index.index + ' (' + data.UV_index.status + ')' : 'N/A'}</td></tr>
                        <tr><th>B√¨nh minh:</th><td>${data.sunrise || 'N/A'}</td></tr>
                        <tr><th>Ho√†ng h√¥n:</th><td>${data.sunset || 'N/A'}</td></tr>
                        <tr><th>Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠:</th><td>${data.air ? data.air.status + ' (AQI ' + data.air.aqi + ')' : 'N/A'}</td></tr>
                    </table>
                </div>`;
        }

        // Load khi trang ready
        document.addEventListener('DOMContentLoaded', load_provinces);
    </script>
</html>
